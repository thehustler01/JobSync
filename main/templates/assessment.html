{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skill Assessment</title>
    <link href="{% static 'img/favicon.ico' %}" rel="icon" />

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500&family=Jost:wght@500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Icon Font Stylesheet -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />

    <!-- Libraries Stylesheet -->
    <link href="{% static 'lib/animate/animate.min.css' %}" rel="stylesheet" />
    <link href="{% static 'lib/animate/animate.min.css' %}" rel="stylesheet" />
    <link
      href="{% static 'lib/lightbox/css/lightbox.min.css' %}"
      rel="stylesheet"
    />

    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet" />
    <link href="{% static 'css/style.css' %}" rel="stylesheet" />
    <style>
        .new-head {
            background-color: #354995;
          }
        {% comment %} .testContainer {
            width: 50%;
            margin: auto;
            background: white;
            padding: 20px;
            margin-top: 13rem;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .testHead {
            color: #333;
        }
        input, button {
            padding: 10px;
            margin-top: 10px;
        }
        button {
            background-color: #28a745;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #218838;
        }
        #quizContainer {
            margin-top: 20px;
            text-align: left;
        }    


        /* Score Styling */
    .score {
        text-align: center;
        font-size: 24px;
        color: #333;
        margin-bottom: 20px;
    }

    /* Explanation Section */
    .review-title {
        text-align: center;
        font-size: 22px;
        color: #444;
        margin-bottom: 15px;
    }

    /* Explanation Box */
    .review-container {
        max-width: 600px;
        margin: 0 auto;
    }

    /* Individual Review Box */
    .review-box {
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 15px;
        box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
    }

    /* Correct Answer */
    .correct {
        background: #e6ffe6;
        border-left: 6px solid #28a745;
    }

    /* Incorrect Answer */
    .wrong {
        background: #ffe6e6;
        border-left: 6px solid #dc3545;
    }

    /* Answer and Explanation Text */
    .result-status {
        font-weight: bold;
        font-size: 18px;
    }

    .correct-answer {
        color: #155724;
        font-weight: bold;
    }

    .explanation-text {
        color: #555;
        font-size: 14px;
    } {% endcomment %}
    /* General Styling */
    html{
        scroll-padding-top: 80px; /* Adjust based on your navbar height */
        scroll-behavior: smooth;
    }
    body {
        font-family: 'Poppins', sans-serif;
        background: #f4f7fc;
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
    }
    
    /* Main Container */
    .testContainer {
        background: #ffffff;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.15);
        max-width: 45rem;
        width: 100%;
        text-align: center;
        margin-top: 10rem;
    }
    
    /* Heading */
    .testHead {
        color: #2c3e50;
        font-size: 25px;
        font-weight: 600;
        margin-bottom: 20px;
    }
    
    /* Input Field */
    #skill {
        width: 80%;
        padding: 12px;
        border: 1px solid #d1d3e2;
        border-radius: 5px;
        font-size: 16px;
    }
    
    /* Submit Button */
    button {
        background: #3498db;
        color: white;
        border: none;
        padding: 10px 15px;
        font-size: 16px;
        border-radius: 5px;
        cursor: pointer;
        margin-top: 10px;
        transition: 0.3s;
    }
    
    button:hover {
        background: #2980b9;
    }
    
    /* Quiz Container */
    #quizContainer {
        text-align: left;
        background: #ecf0f1;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1);
        margin-top: 15px;
    }
    
    /* Quiz Questions */
    #quizContainer p {
        font-size: 16px;
        font-weight: 500;
        margin: 10px 0;
    }
    
    #quizContainer label {
        font-size: 15px;
        cursor: pointer;
        display: block;
        padding: 5px;
    }
    
    /* Submit Answers Button */
    #submitBtn {
        display: none;
        width: 100%;
        padding: 12px;
        margin-top: 15px;
    }
    
    /* Score Display */
    #result h2 {
        color: #2ecc71;
        font-size: 20px;
        margin-top: 20px;
    }
    
    /* Explanation Section */
    #Explanation {
        margin-top: 20px;
        text-align: left;
    }
    
    /* Answer Review Box */
    .review-box {
        background: #fff;
        padding: 12px;
        border-radius: 5px;
        box-shadow: 0px 3px 6px rgba(0, 0, 0, 0.1);
        margin-bottom: 10px;
        border-left: 5px solid #3498db;
    }
    
    /* Correct & Incorrect Answers */
    .correct {
        border-left-color: #2ecc71;
        background: rgba(46, 204, 113, 0.1);
    }
    
    .wrong {
        border-left-color: #e74c3c;
        background: rgba(231, 76, 60, 0.1);
    }
    
    .result-status {
        font-size: 16px;
        font-weight: 600;
        color: #2c3e50;
    }
    
    .correct-answer {
        color: #27ae60;
        font-weight: bold;
    }
    
    .explanation-text {
        color: #34495e;
        font-size: 14px;
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
        .testContainer {
            max-width: 90%;
            padding: 20px;
        }
    
        button {
            width: 100%;
        }
    
        #skill {
            width: 100%;
        }
    }
    

    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light new-head px-4 px-lg-5 py-3 py-lg-0" >
        <a href="" class="navbar-brand p-0">
        <h1 class="m-0">JobSync</h1>
        <!-- <img src="img/logo.png" alt="Logo"> -->
        </a>
        <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#navbarCollapse"
        >
        <span class="fa fa-bars"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
            <div class="navbar-nav mx-auto py-0">
                <a href="{% url 'resumeParser' %}" class="nav-item nav-link ">Home</a>
                <a href="{% url 'chatbot' %}" class="nav-item nav-link">AI Mentor</a>
                <a href="{% url 'career_roadmap' %}" class="nav-item nav-link ">Career Roadmap</a>
                <a href="{% url 'trending_courses' %}" class="nav-item nav-link">Courses</a>
                <a href="{% url 'assessment' %}" class="nav-item nav-link active">Skill Evaluation</a>
                <a href="{% url 'job_search_without_skill' %}" class="nav-item nav-link">Job Search</a>
                <a href="{% url 'hiring_process_insights' %}" class="nav-item nav-link">Hiring Insights</a>
                <a href="{% url 'home' %}" class="nav-item nav-link">Mock Interview</a>
            </div>
        <a
            href="{% url 'course_recommend' %}"
            class="btn rounded-pill py-2 px-4 ms-3 d-none d-lg-block"
            >Recommended Courses</a
        >
        </div>
    </nav>
    <div class="testContainer">
        <h2 class="testHead">Skill Assessment</h2>
        <form id="skillForm">
            <input type="text" id="skill" name="skill" placeholder="Enter Skill" required>
            <button type="submit">Generate Questions</button>
        </form>
        <div id="quizContainer"></div>
        <button id="submitBtn" style="display: none;">Submit Answers</button>
        <div id="result"></div>
        <div id="Explanation"></div>
    </div>

    <script>

        document.getElementById("skillForm").addEventListener("submit", function(event) {
            event.preventDefault();
            let skill = document.getElementById("skill").value;
            fetch("/get_questions/", {
                method: "POST",
                body: new URLSearchParams({ "skill": skill }),
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
            })
            .then(response => response.json())
            .then(data => {
                let quizContainer = document.getElementById("quizContainer");
                quizContainer.innerHTML = "";
                window.correctAnswers = {};
                window.explanations = {};
                data.forEach((q, index) => {
                    let div = document.createElement("div");
                    div.innerHTML = `
                        <p><strong>Q${index + 1}: ${q.question}</strong></p>
                        ${q.options.map((opt, i) => 
                            `<label><input type="radio" name="q${index}" value="${String.fromCharCode(65 + i)}"> ${opt}</label><br>`).join("")}
                    `;
                    quizContainer.appendChild(div);
            
                    // Store the correct answer as a letter (A, B, C, D)
                    window.correctAnswers[`q${index}`] = q.answer;
                    window.explanations[`q${index}`] = q.explanation;
                });
                document.getElementById("submitBtn").style.display = "block";
            });
        });

        document.getElementById("submitBtn").addEventListener("click", function() {
            let userAnswers = {};
            document.querySelectorAll("#quizContainer div").forEach((div, index) => {
                let selected = div.querySelector(`input[name="q${index}"]:checked`);
                if (selected) {
                    userAnswers[`q${index}`] = selected.value;
                }
            });

            fetch("/evaluate/", {
                method: "POST",
                body: new URLSearchParams({ 
                    "answers": JSON.stringify(userAnswers), 
                    "correct_answers": JSON.stringify(window.correctAnswers),
                    "explanations": JSON.stringify(window.explanations) 
                }),
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById("result").innerHTML = 
                    `<h2>Score: ${data.score}/${data.total}</h2>`;
                let explanationHTML = "<h3>Answer Review</h3>";
                
                data.result.forEach((res, index) => {
                    explanationHTML += `
                        <div class="review-box ${res.includes('âœ…') ? 'correct' : 'wrong'}">
                            <p class="result-status">${res}</p>
                            <p><strong>Correct Answer:</strong> <span class="correct-answer">${data.correct_answers[`q${index}`]}</span></p>
                            <p><strong>Explanation:</strong> <span class="explanation-text">${data.explanations[`q${index}`]}</span></p>
                        </div>
                    `;
                });
                document.getElementById("Explanation").innerHTML = explanationHTML;
            });

        });
    </script>

    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'lib/wow/wow.min.js' %}"></script>
    <script src="{% static 'lib/easing/easing.min.js' %}"></script>
    <script src="{% static 'lib/waypoints/waypoints.min.js' %}"></script>
    <script src="{% static 'lib/counterup/counterup.min.js' %}"></script>
    <script src="{% static 'lib/owlcarousel/owl.carousel.min.js' %}"></script>
    <script src="{% static 'lib/isotope/isotope.pkgd.min.js' %}"></script>
    <script src="{% static 'lib/lightbox/js/lightbox.min.js' %}"></script>

    <script src="{% static 'js/main.js' %}"></script>
</body>
</html>
